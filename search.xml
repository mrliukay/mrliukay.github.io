<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Redis发布订阅和Redis监听</title>
      <link href="/liukai/2023/04/15/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E5%92%8CRedis%E7%9B%91%E5%90%AC/"/>
      <url>/liukai/2023/04/15/Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E5%92%8CRedis%E7%9B%91%E5%90%AC/</url>
      
        <content type="html"><![CDATA[<h1 id="Redis发布订阅和监听"><a href="#Redis发布订阅和监听" class="headerlink" title="Redis发布订阅和监听"></a>Redis发布订阅和监听</h1><blockquote><p>摘要”</p><p>本篇博客主要介绍以下内容:</p><ul><li>Redis发布订阅;</li><li>Redis监听过期</li></ul></blockquote><h2 id="1-Redis发布订阅"><a href="#1-Redis发布订阅" class="headerlink" title="1 Redis发布订阅"></a>1 Redis发布订阅</h2><blockquote><p>注意:</p><p>Redis版本大于等2.0</p></blockquote><h3 id="1-1-Redis发布订阅代码"><a href="#1-1-Redis发布订阅代码" class="headerlink" title="1.1 Redis发布订阅代码"></a>1.1 Redis发布订阅代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liukai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023/3/22 15:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;redis.topic&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redisTopic;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisMessageListenerContainer <span class="title function_">listenerContainer</span><span class="params">(RedisConnectionFactory factory, MessageListenerAdapter messageListenerAdapter)</span> &#123;</span><br><span class="line">        <span class="type">RedisMessageListenerContainer</span> <span class="variable">container</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisMessageListenerContainer</span>();</span><br><span class="line">        container.setConnectionFactory(factory);</span><br><span class="line">        List&lt;Topic&gt; topicList = Arrays.asList(<span class="keyword">new</span> <span class="title class_">PatternTopic</span>(redisTopic));</span><br><span class="line">        container.addMessageListener(messageListenerAdapter, topicList);</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MessageListenerAdapter <span class="title function_">messageListenerAdapter</span><span class="params">(RedisReceiver redisReceiver)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MessageListenerAdapter</span>(redisReceiver, <span class="string">&quot;onMessage&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * redis 消息监听回调</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liukai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023/3/22 15:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisReceiver</span> <span class="keyword">implements</span> <span class="title class_">MessageListener</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * description</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message 信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes   字节数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Nullable</span> Message message, <span class="meta">@Nullable</span> <span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;进来了回调方法！&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;回调的信息 message=&#123;&#125;&quot;</span>, message);</span><br><span class="line">        log.info(<span class="string">&quot;回调的信息 bytes=&#123;&#125;&quot;</span>, StrUtil.str(bytes, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-Redis发布订阅结果演示"><a href="#1-2-Redis发布订阅结果演示" class="headerlink" title="1.2 Redis发布订阅结果演示"></a>1.2 Redis发布订阅结果演示</h3><blockquote><p>首先创建一个controller来完成模拟发布方</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试控制层</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liukai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023/3/22 0:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;测试接口层&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test/apis&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ISysUserService iSysUserService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IStWyzService iStWyzService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;redis.topic&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redisTopic;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/redis/message/push&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;Redis发布消息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">wyzList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> iSysUserService.getUser(<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        stringRedisTemplate.convertAndSend(redisTopic, JSONUtil.toJsonStr(user));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>发送后控制台打印结果截图如下</p></blockquote><p><img src="https://gitee.com/mrkay0313/images/raw/master/img/20230415233536.png"></p><p><img src="https://gitee.com/mrkay0313/images/raw/master/img/20230415233608.png"></p><p><img src="https://gitee.com/mrkay0313/images/raw/master/img/20230415233637.png"></p><h2 id="2-Redis监听过期Key"><a href="#2-Redis监听过期Key" class="headerlink" title="2 Redis监听过期Key"></a>2 Redis监听过期Key</h2><blockquote><p>Redis监听过期Key需要对Redis配置文件 reids.windows.config 文件进行修改</p><p>这里演示使用windows版Redis的修改,Linux修改的参数一致</p></blockquote><h3 id="2-1-修改Redis配置并重启"><a href="#2-1-修改Redis配置并重启" class="headerlink" title="2.1 修改Redis配置并重启"></a>2.1 修改Redis配置并重启</h3><p><img src="https://gitee.com/mrkay0313/images/raw/master/img/20230415234716.png"></p><blockquote><p>启动重启redis服务</p><p>redis-server redis.windows.config</p></blockquote><h3 id="2-2-代码中增加过期监听topic"><a href="#2-2-代码中增加过期监听topic" class="headerlink" title="2.2 代码中增加过期监听topic"></a>2.2 代码中增加过期监听topic</h3><blockquote><p>增加代码如下</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liukai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023/3/22 15:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;redis.topic&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redisTopic;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisMessageListenerContainer <span class="title function_">listenerContainer</span><span class="params">(RedisConnectionFactory factory, MessageListenerAdapter messageListenerAdapter)</span> &#123;</span><br><span class="line">        <span class="type">RedisMessageListenerContainer</span> <span class="variable">container</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisMessageListenerContainer</span>();</span><br><span class="line">        container.setConnectionFactory(factory);</span><br><span class="line">        List&lt;Topic&gt; topicList = Arrays.asList(<span class="keyword">new</span> <span class="title class_">PatternTopic</span>(<span class="string">&quot;__keyevent@0__:expired&quot;</span>), <span class="keyword">new</span> <span class="title class_">PatternTopic</span>(redisTopic));</span><br><span class="line">        container.addMessageListener(messageListenerAdapter, topicList);</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MessageListenerAdapter <span class="title function_">messageListenerAdapter</span><span class="params">(RedisReceiver redisReceiver)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MessageListenerAdapter</span>(redisReceiver, <span class="string">&quot;onMessage&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-Redis监听过期Key结果演示"><a href="#2-3-Redis监听过期Key结果演示" class="headerlink" title="2.3 Redis监听过期Key结果演示"></a>2.3 Redis监听过期Key结果演示</h3><blockquote><p>controller增加一个接口</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试控制层</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liukai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023/3/22 0:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;测试接口层&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test/apis&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ISysUserService iSysUserService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IStWyzService iStWyzService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;redis.topic&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redisTopic;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/redis/message/push&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;Redis发布消息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">wyzList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> iSysUserService.getUser(<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        stringRedisTemplate.convertAndSend(redisTopic, JSONUtil.toJsonStr(user));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/redis/message/listener/exp&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;redis监听过期key&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">redisMessageListenerExp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> iSysUserService.getUser(<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        <span class="comment">//60秒过期</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;exp_key_&quot;</span> + RandomUtil.randomNumbers(<span class="number">5</span>), user.getUserName(), <span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>控制太答应结果如下</p></blockquote><p><img src="https://gitee.com/mrkay0313/images/raw/master/img/20230415235651.png"></p><p><img src="https://gitee.com/mrkay0313/images/raw/master/img/20230415235738.png"></p><p><img src="https://gitee.com/mrkay0313/images/raw/master/img/20230415235816.png"></p><h2 id="3-结束语"><a href="#3-结束语" class="headerlink" title="3 结束语"></a>3 结束语</h2><blockquote><p>本次主要记录了Redis的发布订阅和过期监听并没有Redis进行深入研究.</p><p>好了文章记录结束</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/liukai/2023/04/10/hello-world/"/>
      <url>/liukai/2023/04/10/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
